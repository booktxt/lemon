Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,i=Number(arguments[1])||0;for(i=0>i?Math.ceil(i):Math.floor(i),0>i&&(i+=t);t>i;i++)if(i in this&&this[i]===e)return i;return-1});var app=angular.module("app",["plugin"]);angular.module("plugin",[]).factory("$$stackedMap",function(){return{createNew:function(){var e=[];return{add:function(t,i){e.push({key:t,value:i})},get:function(t){for(var i=0;i<e.length;i++)if(t==e[i].key)return e[i]},keys:function(){for(var t=[],i=0;i<e.length;i++)t.push(e[i].key);return t},top:function(){return e[e.length-1]},remove:function(t){for(var i=-1,a=0;a<e.length;a++)if(t==e[a].key){i=a;break}return e.splice(i,1)[0]},removeTop:function(){return e.splice(e.length-1,1)[0]},length:function(){return e.length}}}}}).directive("modalBackdrop",["$timeout",function(e){function t(t){t.animate=!1,e(function(){t.animate=!0})}return{restrict:"EA",replace:!0,templateUrl:"/template/backdrop.html",compile:function(e,i){return e.addClass(i.backdropClass),t}}}]).directive("modalWindow",["$modalStack","$q",function(e,t){return{restrict:"EA",scope:{index:"@",animate:"="},replace:!0,transclude:!0,templateUrl:function(e,t){return t.templateUrl||"/template/window.html"},link:function(i,a,l){a.addClass(l.windowClass||""),i.size=l.size,i.close=function(t){var i=e.getTop();i&&i.value.backdrop&&"static"!=i.value.backdrop&&t.target===t.currentTarget&&(t.preventDefault(),t.stopPropagation(),e.dismiss(i.key,"backdrop click"))},i.$isRendered=!0;var n=t.defer();l.$observe("modalRender",function(e){"true"==e&&n.resolve()}),n.promise.then(function(){i.animate=!0;var t=a[0].querySelectorAll("[autofocus]");t.length?t[0].focus():a[0].focus();var l=e.getTop();l&&e.modalRendered(l.key)})}}}]).directive("modalAnimationClass",[function(){return{compile:function(e,t){t.modalAnimation&&e.addClass(t.modalAnimationClass)}}}]).directive("modalTransclude",function(){return{link:function(e,t,i,a,l){l(e.$parent,function(e){t.empty(),t.append(e)})}}}).factory("$modalStack",["$animate","$timeout","$document","$compile","$rootScope","$$stackedMap",function(e,t,i,a,l,n){function r(){for(var e=-1,t=y.keys(),i=0;i<t.length;i++)y.get(t[i]).value.backdrop&&(e=i);return e}function s(e){var t=i.find("body").eq(0),a=y.get(e).value;y.remove(e),d(a.modalDomEl,a.modalScope,function(){t.toggleClass(v,y.length()>0),o()})}function o(){if(u&&-1==r()){var e=p;d(u,p,function(){e=null}),u=void 0,p=void 0}}function d(i,a,n){function r(){r.done||(r.done=!0,i.remove(),a.$destroy(),n&&n())}a.animate=!1,i.attr("modal-animation")&&e.enabled()?i.one("$animate:close",function(){l.$evalAsync(r)}):t(r)}function c(e,t,i){return!e.value.modalScope.$broadcast("modal.closing",t,i).defaultPrevented}var u,p,v="modal-open",y=n.createNew(),f={};return l.$watch(r,function(e){p&&(p.index=e)}),i.bind("keydown",function(e){var t;27===e.which&&(t=y.top(),t&&t.value.keyboard&&(e.preventDefault(),l.$apply(function(){f.dismiss(t.key,"escape key press")})))}),f.open=function(e,t){var n=i[0].activeElement;y.add(e,{deferred:t.deferred,renderDeferred:t.renderDeferred,modalScope:t.scope,backdrop:t.backdrop,keyboard:t.keyboard});var s=i.find("body").eq(0),o=r();if(o>=0&&!u){p=l.$new(!0),p.index=o;var d=angular.element('<div modal-backdrop="modal-backdrop"></div>');d.attr("backdrop-class",t.backdropClass),t.animation&&d.attr("modal-animation","true"),u=a(d)(p),s.append(u)}var c=angular.element('<div modal-window="modal-window"></div>');c.attr({"template-url":t.windowTemplateUrl,"window-class":t.windowClass,size:t.size,index:y.length()-1,animate:"animate"}).html(t.content),t.animation&&c.attr("modal-animation","true");var f=a(c)(t.scope);y.top().value.modalDomEl=f,y.top().value.modalOpener=n,s.append(f),s.addClass(v)},f.close=function(e,t){var i=y.get(e);return i&&c(i,t,!0)?(i.value.deferred.resolve(t),s(e),i.value.modalOpener.focus(),!0):!i},f.dismiss=function(e,t){var i=y.get(e);return i&&c(i,t,!1)?(i.value.deferred.reject(t),s(e),i.value.modalOpener.focus(),!0):!i},f.dismissAll=function(e){for(var t=this.getTop();t&&this.dismiss(t.key,e);)t=this.getTop()},f.getTop=function(){return y.top()},f.modalRendered=function(e){var t=y.get(e);t&&t.value.renderDeferred.resolve()},f}]).provider("$modal",function(){var e={options:{animation:!0,backdrop:!0,keyboard:!0},$get:["$injector","$rootScope","$q","$http","$templateCache","$controller","$modalStack",function(t,i,a,l,n,r,s){function o(e){return e.template?a.when(e.template):l.get(angular.isFunction(e.templateUrl)?e.templateUrl():e.templateUrl,{cache:n}).then(function(e){return e.data})}function d(e){var i=[];return angular.forEach(e,function(e){(angular.isFunction(e)||angular.isArray(e))&&i.push(a.when(t.invoke(e)))}),i}var c={};return c.open=function(t){var l=a.defer(),n=a.defer(),c=a.defer(),u={result:l.promise,opened:n.promise,rendered:c.promise,close:function(e){return s.close(u,e)},dismiss:function(e){return s.dismiss(u,e)}};if(t=angular.extend({},e.options,t),t.resolve=t.resolve||{},!t.template&&!t.templateUrl)throw new Error("One of template or templateUrl options is required.");var p=a.all([o(t)].concat(d(t.resolve)));return p.then(function(e){var a=(t.scope||i).$new();a.$close=u.close,a.$dismiss=u.dismiss;var n,o={},d=1;t.controller&&(o.$scope=a,o.$modalInstance=u,angular.forEach(t.resolve,function(t,i){o[i]=e[d++]}),n=r(t.controller,o),t.controllerAs&&(a[t.controllerAs]=n)),s.open(u,{scope:a,deferred:l,renderDeferred:c,content:e[0],animation:t.animation,backdrop:t.backdrop,keyboard:t.keyboard,backdropClass:t.backdropClass,windowClass:t.windowClass,windowTemplateUrl:t.windowTemplateUrl,size:t.size})},function(e){l.reject(e)}),p.then(function(){n.resolve(!0)},function(e){n.reject(e)}),u},c}]};return e}).service("alertMsg",["$timeout","$rootScope","$compile",function(e,t,i){var a={type:"error",content:"请填写错误或正确的提示"},l=function(e,l){angular.element(".alert-tips").remove();var n=angular.extend({},a,l);angular.element(e).after(i('<div alert alerttype="'+n.type+'" content="'+n.content+'"></div>')(t))},n={show:l};return n}]).service("captcha",["$rootScope","$compile","$http",function(e,t,i){var a=function(e){e.preventDefault(),i.get("/common/vcode/captcha").success(function(){var t=new Date;angular.element(e.target).attr("src","/common/vcode/captcha?="+t.getFullYear()+"-"+t.getMonth()+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getMilliseconds())})},l={refresh:a};return l}]).directive("calendar",["$http",function(e){return{restrict:"A",scope:{currentDay:"@currentday",no:"@",selectedDay:"=selectedday",tourismId:"@tourismid",stock:"=stock",deadline:"=deadline",deadDay:"=deadday",price:"="},template:'<div class="calendar-title"><div class="prev" ng-class="{disabled:prevDisabled}" ng-click="prev($event)">上一月</div><div class="date" ng-bind="title"></div><div class="next" ng-class="{disabled:nextDisabled}" ng-click="next($event)">下一月</div></div><div class="calendar-content"><div class="left"><div ng-if="loading" class="calendar_loading"><img src="/css/front/images/loading_32px.gif"/></div><div ng-show="error" class="calendar_retry"><div class="retryContent">加载失败，<span ng-click="retry()" class="click">请点击刷新</span></div></div><div ng-if="!loading && !error"><div class="calendar-content-title"><span class="day">日</span><span class="day">一</span><span class="day">二</span><span class="day">三</span><span class="day">四</span><span class="day">五</span><span class="day last">六</span></div><div class="calendar-content-main"><div ng-repeat="row in dayArray track by $index" class="row"><span ng-repeat="col in row track by $index" ng-click="click($event,col,(data | stock:title:col).stock)" ng-class="{last:$last,selected:(selectedDay | selectedDay:title:dayArray[$parent.$index][$index]),available:(data | stock:title:dayArray[$parent.$index][$index]).flag}" ng-bind="col" class="day"></span></div></div></div></div><div class="right"><div calss="right-deadline" style="color: #9b9b9b">本行程需在<span ng-bind="deadDay"></span>前预订</div><div class="right-title" ng-cloak ng-if="!selectedDay" style="color: #9b9b9b;margin-top: 5px">请先选择出行日期</div><div class="right-title" ng-cloak ng-if="selectedDay" style="color: #9b9b9b;margin-top: 5px">您已选择于：</div><div class="right-time" ng-bind="selectedDay?(selectedDay | dayCN) : \'\'"></div><div class="right-stock error" ng-if="stock&&no>stock" ng-bind="no>stock?\'库存不足\' : false "></div><div class="right-stock" ng-if="stock&&no<=stock" ng-bind="stock>6?\'库存充足\' : \'剩余\' + stock + \'个座位\' "></div><div class="right-price" ng-if="price" ng-bind="\'RMB \' + price"></div></div></div>',link:function(t){function i(i){t.loading=!0,t.error=!1,t.prevDisabled=!0,t.nextDisabled=!0,t.dayArray=[];var a=[],l=i?new Date(i.split("-")[0],i.split("-")[1]-1,i.split("-")[2]):new Date(t.currentDay.split("-")[0],t.currentDay.split("-")[1]-1,t.currentDay.split("-")[2]);t.title=l.getFullYear()+"-"+(l.getMonth()+1),t.now=l.getFullYear()+"-"+(l.getMonth()+1)+"-"+l.getDate(),l.setDate(1);var n=l.getDay();l.setMonth(l.getMonth()+1),l.setDate(0);for(var r=l.getDay(),s=l.getDate(),o=-n;n+s+6-r>o;o++)a.push(0>o||o>s-1?"":o+1);for(var d=0;n+s+6-r>d;d+=7)t.dayArray.push(a.slice(d,d+7));e.post("/web/front/tourism/stock",{webTourismId:t.tourismId,startDate:t.title+"-1",endDate:t.title+"-"+s}).success(function(e){0==e.code?(t.loading=!1,t.error=!1,t.data=e.data.prices,t.prevDisabled=!1,t.nextDisabled=!1):2==e.code&&(t.loading=!1,t.error=!1,t.prevDisabled=!1,t.nextDisabled=!1)}).error(function(){t.loading=!1,t.error=!0,t.prevDisabled=!1,t.nextDisabled=!1})}t.loading=!1,t.error=!1,t.dayArray=[],t.isPreDeadline=!1,t.isNowDeadline=!1,i(),t.retry=function(){i(t.now)},t.click=function(e,i,a){e.stopPropagation(),t.isPreDeadline=!1,t.isNowDeadline=!1,angular.element(e.target).hasClass("available")&&(t.selectedDay=t.title+"-"+i,t.stock=a.count,t.price=a.price)},t.prev=function(e){if(!angular.element(e.target).hasClass("disabled")){e.stopPropagation();var a=new Date(t.now.split("-")[0],t.now.split("-")[1]-1,t.now.split("-")[2]),l=new Date(t.now.split("-")[0],t.now.split("-")[1]-1,t.now.split("-")[2]);l.setDate(0);var n=a.getDate(),r=l.getDate(),s="";s=n>r?l.getFullYear()+"-"+(l.getMonth()+1)+"-"+l.getDate():0==a.getMonth()?a.getFullYear()-1+"-12-"+a.getDate():a.getFullYear()+"-"+a.getMonth()+"-"+a.getDate(),i(s)}},t.next=function(e){if(!angular.element(e.target).hasClass("disabled")){e.stopPropagation();var a=new Date(t.now.split("-")[0],t.now.split("-")[1]-1,t.now.split("-")[2]),l=new Date(t.now.split("-")[0],t.now.split("-")[1]-1,t.now.split("-")[2]);l.setDate(1),l.setMonth(l.getMonth()+2),l.setDate(0);var n=a.getDate(),r=l.getDate(),s="";s=n>r?l.getFullYear()+"-"+(l.getMonth()+1)+"-"+l.getDate():a.getMonth()+2==13?a.getFullYear()+1+"-1-"+a.getDate():a.getFullYear()+"-"+(a.getMonth()+2)+"-"+a.getDate(),i(s)}}}}}]).directive("cardCalendar",["$http",function(e){return{restrict:"A",scope:{currentDay:"@currentday",no:"@",selectedDay:"=selectedday",cardDeadLineDate:"=carddeadlinedate",isCardDeadLine:"=iscarddeadline",tourismId:"@tourismid",stock:"=stock",deadline:"=deadline",deadDay:"=deadday",price:"="},template:'<div class="calendar-title"><div class="prev" ng-class="{disabled:prevDisabled}" ng-click="prev($event)">上一月</div><div class="date" ng-bind="title"></div><div class="next" ng-class="{disabled:nextDisabled}" ng-click="next($event)">下一月</div></div><div class="calendar-content"><div class="left"><div ng-if="loading" class="calendar_loading"><img src="/css/front/images/loading_32px.gif"/></div><div ng-show="error" class="calendar_retry"><div class="retryContent">加载失败，<span ng-click="retry()" class="click">请点击刷新</span></div></div><div ng-if="!loading && !error"><div class="calendar-content-title"><span class="day">日</span><span class="day">一</span><span class="day">二</span><span class="day">三</span><span class="day">四</span><span class="day">五</span><span class="day last">六</span></div><div class="calendar-content-main"><div ng-repeat="row in dayArray track by $index" class="row"><span ng-repeat="col in row track by $index" ng-click="click($event,col,(data | stock:title:col).stock)" ng-class="{last:$last,selected:(selectedDay | selectedDay:title:dayArray[$parent.$index][$index]),available:(data | stock:title:dayArray[$parent.$index][$index]).flag}" ng-bind="col" class="day"></span></div></div></div></div><div class="right"><div calss="right-deadline" style="color: #9b9b9b">本行程需在<span ng-bind="deadDay"></span>前预订</div><div class="right-title" ng-cloak ng-if="!selectedDay" style="color: #9b9b9b;margin-top: 5px">请先选择出行日期</div><div class="right-title" ng-cloak ng-if="selectedDay" style="color: #9b9b9b;margin-top: 5px">您已选择于：</div><div class="right-time" ng-bind="selectedDay?(selectedDay | dayCN) : \'\'"></div><div class="right-stock error" ng-if="stock&&no>stock" ng-bind="no>stock?\'库存不足\' : false "></div><div class="right-stock" ng-if="stock&&no<=stock" ng-bind="stock>6?\'库存充足\' : \'剩余\' + stock + \'个座位\' "></div><div class="right-price" ng-if="price" ng-bind="\'简途通\'+price+\'天\'"></div></div></div>',link:function(t){function i(i){t.loading=!0,t.error=!1,t.prevDisabled=!0,t.nextDisabled=!0,t.dayArray=[];var a=[],l=i?new Date(i.split("-")[0],i.split("-")[1]-1,i.split("-")[2]):new Date(t.currentDay.split("-")[0],t.currentDay.split("-")[1]-1,t.currentDay.split("-")[2]);t.title=l.getFullYear()+"-"+(l.getMonth()+1),t.now=l.getFullYear()+"-"+(l.getMonth()+1)+"-"+l.getDate(),l.setDate(1);var n=l.getDay();l.setMonth(l.getMonth()+1),l.setDate(0);for(var r=l.getDay(),s=l.getDate(),o=-n;n+s+6-r>o;o++)a.push(0>o||o>s-1?"":o+1);for(var d=0;n+s+6-r>d;d+=7)t.dayArray.push(a.slice(d,d+7));e.post("/web/front/card/tourism/stock",{webTourismId:t.tourismId,startDate:t.title+"-1",endDate:t.title+"-"+s}).success(function(e){0==e.code?(t.loading=!1,t.error=!1,t.data=e.data.prices,t.prevDisabled=!1,t.nextDisabled=!1):2==e.code&&(t.loading=!1,t.error=!1,t.prevDisabled=!1,t.nextDisabled=!1)}).error(function(){t.loading=!1,t.error=!0,t.prevDisabled=!1,t.nextDisabled=!1})}t.loading=!1,t.error=!1,t.dayArray=[],i(),t.retry=function(){i(t.now)},t.click=function(e,i,a){if(e.stopPropagation(),angular.element(e.target).hasClass("available")){if(t.selectedDay=t.title+"-"+i,t.stock=a.count,t.price=a.cardExchangeDays,t.cardDeadLineDate)var l=t.cardDeadLineDate.split(" "),n=l[0].split("-"),r=l.length>1?l[1].split(":"):[0,0,0],s=new Date(n[0],n[1]-1,n[2],r[0],r[1],r[2]);if(t.selectedDay)var o=t.selectedDay.split(" "),d=o[0].split("-"),c=o.length>1?o[1].split(":"):[0,0,0],u=new Date(d[0],d[1]-1,d[2],c[0],c[1],c[2]);u&&s&&(t.isCardDeadLine=u.getTime()>=s.getTime()?!0:!1)}},t.prev=function(e){if(!angular.element(e.target).hasClass("disabled")){e.stopPropagation();var a=new Date(t.now.split("-")[0],t.now.split("-")[1]-1,t.now.split("-")[2]),l=new Date(t.now.split("-")[0],t.now.split("-")[1]-1,t.now.split("-")[2]);l.setDate(0);var n=a.getDate(),r=l.getDate(),s="";s=n>r?l.getFullYear()+"-"+(l.getMonth()+1)+"-"+l.getDate():0==a.getMonth()?a.getFullYear()-1+"-12-"+a.getDate():a.getFullYear()+"-"+a.getMonth()+"-"+a.getDate(),i(s)}},t.next=function(e){if(!angular.element(e.target).hasClass("disabled")){e.stopPropagation();var a=new Date(t.now.split("-")[0],t.now.split("-")[1]-1,t.now.split("-")[2]),l=new Date(t.now.split("-")[0],t.now.split("-")[1]-1,t.now.split("-")[2]);l.setDate(1),l.setMonth(l.getMonth()+2),l.setDate(0);var n=a.getDate(),r=l.getDate(),s="";s=n>r?l.getFullYear()+"-"+(l.getMonth()+1)+"-"+l.getDate():a.getMonth()+2==13?a.getFullYear()+1+"-1-"+a.getDate():a.getFullYear()+"-"+(a.getMonth()+2)+"-"+a.getDate(),i(s)}}}}}]).directive("dyName",function(){return{require:"ngModel",link:function(e,t,i,a){a.$name=e.$eval(i.dyName);var l=t.controller("form")||{$addControl:angular.noop};l.$addControl(a),e.$on("$destroy",function(){l.$removeControl(a)})}}}).directive("userName",function(){return{scope:{},require:"ngModel",link:function(e,t,i,a){angular.element(t).focusin(function(){a.$dirty=!0,a.$pristine=!1}),a.$parsers.unshift(function(t){return e.nameNull=""!=t?"valid":void 0,e.nameRule=/^\s*[\u4e00-\u9fa5a-zA-Z0-9]{2,20}\s*$/.test(t)?"valid":void 0,e.nameNull&&!e.nameRule?(a.$setValidity("nameNull",!0),a.$setValidity("nameRule",!1),a.$setValidity("name",!1),t):e.nameRule&&!e.nameNull?(a.$setValidity("nameRule",!0),a.$setValidity("nameNull",!1),a.$setValidity("name",!1),t):e.nameNull||e.nameRule?e.nameRule&&e.nameNull?(a.$setValidity("nameNull",!0),a.$setValidity("nameRule",!0),a.$setValidity("name",!0),t):void 0:(a.$setValidity("nameNull",!1),a.$setValidity("nameRule",!1),a.$setValidity("name",!1),t)}),a.$formatters.unshift(function(t){return e.nameNull=""!=t?"valid":void 0,e.nameRule=/^\s*[\u4e00-\u9fa5a-zA-Z0-9]{2,20}\s*$/.test(t)?"valid":void 0,e.nameNull&&!e.nameRule?(a.$setValidity("nameNull",!0),a.$setValidity("nameRule",!1),a.$setValidity("name",!1),t):e.nameRule&&!e.nameNull?(a.$setValidity("nameRule",!0),a.$setValidity("nameNull",!1),a.$setValidity("name",!1),t):e.nameNull||e.nameRule?e.nameRule&&e.nameNull?(a.$setValidity("nameNull",!0),a.$setValidity("nameRule",!0),a.$setValidity("name",!0),t):void 0:(a.$setValidity("nameNull",!1),a.$setValidity("nameRule",!1),a.$setValidity("name",!1),t)})}}}).directive("userMobile",function(){return{scope:{},require:"ngModel",link:function(e,t,i,a){angular.element(t).focusin(function(){a.$dirty=!0,a.$pristine=!1}),a.$parsers.unshift(function(t){return e.mobileNull=""!=t?"valid":void 0,e.mobileRule=/^0?(13|14|15|17|18)[0-9]{9}$/.test(t)?"valid":void 0,e.mobileNull&&!e.mobileRule?(a.$setValidity("mobileNull",!0),a.$setValidity("mobileRule",!1),a.$setValidity("mobile",!1),t):e.mobileRule&&!e.mobileNull?(a.$setValidity("mobileRule",!0),a.$setValidity("mobileNull",!1),a.$setValidity("mobile",!1),t):e.mobileNull||e.mobileRule?e.mobileRule&&e.mobileNull?(a.$setValidity("mobileNull",!0),a.$setValidity("mobileRule",!0),a.$setValidity("mobile",!0),t):void 0:(a.$setValidity("mobileNull",!1),a.$setValidity("mobileRule",!1),a.$setValidity("mobile",!1),t)}),a.$formatters.unshift(function(t){return e.mobileNull=""!=t?"valid":void 0,e.mobileRule=/^0?(13|14|15|17|18)[0-9]{9}$/.test(t)?"valid":void 0,e.mobileNull&&!e.mobileRule?(a.$setValidity("mobileNull",!0),a.$setValidity("mobileRule",!1),a.$setValidity("mobile",!1),t):e.mobileRule&&!e.mobileNull?(a.$setValidity("mobileRule",!0),a.$setValidity("mobileNull",!1),a.$setValidity("mobile",!1),t):e.mobileNull||e.mobileRule?e.mobileRule&&e.mobileNull?(a.$setValidity("mobileNull",!0),a.$setValidity("mobileRule",!0),a.$setValidity("mobile",!0),t):void 0:(a.$setValidity("mobileNull",!1),a.$setValidity("mobileRule",!1),a.$setValidity("mobile",!1),t)})}}}).directive("userId",function(){return{scope:{idType:"=idType"},require:"ngModel",link:function(e,t,i,a){angular.element(t).focusin(function(){a.$dirty=!0,a.$pristine=!1});var l=function(e){var t=!0,i=/^(^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$)|(^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[Xx])$)$/;if(i.test(e))if(18==e.length){for(var a=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2),l=new Array(1,0,10,9,8,7,6,5,4,3,2),n=0,r=0;17>r;r++)n+=e.substring(r,r+1)*a[r];var s=n%11,o=e.substring(17);2==s?"X"==o||"x"==o||(t=!1):o==l[s]||(t=!1)}else t=!1;else t=!1;return t};a.$parsers.unshift(function(t){if(e.idNull=""!=t?"valid":void 0,"id"===e.idType){e.idRule=l(t);var i=new Date,n=i.getFullYear(),r=parseInt(t.substr(6,4));e.age=n-r>=6&&70>n-r?!0:!1}else e.idRule=!0,e.age=!0;return e.$watch("idType",function(){if("id"===e.idType){e.idRule=l(t);var i=new Date,n=i.getFullYear(),r=parseInt(t.substr(6,4));e.age=n-r>=6&&70>n-r?!0:!1}else e.idRule=!0,e.age=!0;return e.idNull?a.$setValidity("idNull",!0):a.$setValidity("idNull",!1),e.idRule?a.$setValidity("idRule",!0):a.$setValidity("idRule",!1),e.age?a.$setValidity("idAge",!0):a.$setValidity("idAge",!1),e.idNull&&e.idRule&&e.age?(a.$setValidity("id",!0),t):(a.$setValidity("id",!1),t)}),e.idNull?a.$setValidity("idNull",!0):a.$setValidity("idNull",!1),e.idRule?a.$setValidity("idRule",!0):a.$setValidity("idRule",!1),e.age?a.$setValidity("idAge",!0):a.$setValidity("idAge",!1),e.idNull&&e.idRule&&e.age?(a.$setValidity("id",!0),t):(a.$setValidity("id",!1),t)}),a.$formatters.unshift(function(t){if(e.idNull=""!=t?"valid":void 0,"id"===e.idType){e.idRule=l(t);var i=new Date,n=i.getFullYear(),r=parseInt(t.substr(6,4));e.age=n-r>=6&&70>n-r?!0:!1}else e.idRule=!0,e.age=!0;return e.$watch("idType",function(){if("id"===e.idType){e.idRule=l(t);var i=new Date,n=i.getFullYear(),r=parseInt(t.substr(6,4));e.age=n-r>=6&&70>n-r?!0:!1}else e.idRule=!0,e.age=!0;return e.idNull?a.$setValidity("idNull",!0):a.$setValidity("idNull",!1),e.idRule?a.$setValidity("idRule",!0):a.$setValidity("idRule",!1),e.age?a.$setValidity("idAge",!0):a.$setValidity("idAge",!1),e.idNull&&e.idRule&&e.age?(a.$setValidity("id",!0),t):(a.$setValidity("id",!1),t)}),e.idNull?a.$setValidity("idNull",!0):a.$setValidity("idNull",!1),e.idRule?a.$setValidity("idRule",!0):a.$setValidity("idRule",!1),e.age?a.$setValidity("idAge",!0):a.$setValidity("idAge",!1),e.idNull&&e.idRule&&e.age?(a.$setValidity("id",!0),t):(a.$setValidity("id",!1),t)})}}}).directive("userEmail",function(){return{scope:{},require:"ngModel",link:function(e,t,i,a){angular.element(t).focusin(function(){a.$dirty=!0,a.$pristine=!1}),a.$parsers.unshift(function(t){return e.emailRule=""==t||/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/.test(t)?"valid":void 0,e.emailRule?(a.$setValidity("email",!0),t):(a.$setValidity("email",!1),t)}),a.$formatters.unshift(function(t){return e.emailRule=""==t||/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/.test(t)?"valid":void 0,e.emailRule?(a.$setValidity("email",!0),t):(a.$setValidity("email",!1),t)})}}}).directive("password",function(){return{scope:{},require:"ngModel",link:function(e,t,i,a){angular.element(t).focusin(function(){a.$dirty=!0,a.$pristine=!1}),a.$parsers.unshift(function(t){return e.pwNull=""==t?void 0:"valid",e.pwRule=/^\s*[a-zA-Z0-9]{6,20}\s*$/.test(t)?"valid":void 0,e.pwNull?a.$setValidity("pwNull",!0):a.$setValidity("pwNull",!1),e.pwRule?a.$setValidity("pwRule",!0):a.$setValidity("pwRule",!1),e.pwNull&&e.pwRule?(a.$setValidity("pw",!0),t):(a.$setValidity("pw",!1),t)}),a.$formatters.unshift(function(t){return e.pwNull=""==t?void 0:"valid",e.pwRule=/^\s*[a-zA-Z0-9]{6,20}\s*$/.test(t)?"valid":void 0,e.pwNull?a.$setValidity("pwNull",!0):a.$setValidity("pwNull",!1),e.pwRule?a.$setValidity("pwRule",!0):a.$setValidity("pwRule",!1),e.pwNull&&e.pwRule?(a.$setValidity("pw",!0),t):(a.$setValidity("pw",!1),t)})}}}).directive("confirmpasswd",function(){return{scope:{oldPw:"=oldpw"},require:"ngModel",link:function(e,t,i,a){angular.element(t).focusin(function(){a.$dirty=!0,a.$pristine=!1}),e.$watch("oldPw",function(){var t=a.$viewValue;return e.cpwNull=""==t?void 0:"valid",e.cpwRule=""!=t&&t==e.oldPw?"valid":void 0,e.cpwNull?a.$setValidity("cpwNull",!0):a.$setValidity("cpwNull",!1),e.cpwRule?a.$setValidity("cpwRule",!0):a.$setValidity("cpwRule",!1),e.cpwNull&&e.cpwRule?(a.$setValidity("cpw",!0),t):(a.$setValidity("cpw",!1),t)}),a.$parsers.unshift(function(t){return e.cpwNull=""==t?void 0:"valid",e.cpwRule=""!=t&&t==e.oldPw?"valid":void 0,e.cpwNull?a.$setValidity("cpwNull",!0):a.$setValidity("cpwNull",!1),e.cpwRule?a.$setValidity("cpwRule",!0):a.$setValidity("cpwRule",!1),e.cpwNull&&e.cpwRule?(a.$setValidity("cpw",!0),t):(a.$setValidity("cpw",!1),t)}),a.$formatters.unshift(function(t){return e.cpwNull=""==t?void 0:"valid",e.cpwRule=""!=t&&t==e.oldPw?"valid":void 0,e.cpwNull?a.$setValidity("cpwNull",!0):a.$setValidity("cpwNull",!1),e.cpwRule?a.$setValidity("cpwRule",!0):a.$setValidity("cpwRule",!1),e.cpwNull&&e.cpwRule?(a.$setValidity("cpw",!0),t):(a.$setValidity("cpw",!1),t)})}}}).directive("vcode",function(){return{scope:{},require:"ngModel",link:function(e,t,i,a){angular.element(t).focusin(function(){a.$dirty=!0,a.$pristine=!1}),a.$parsers.unshift(function(t){return e.vcodeNull=""==t?void 0:"valid",e.vcodeRule=/^\s*[0-9]{5}\s*$/.test(t)?"valid":void 0,e.vcodeNull?a.$setValidity("vcodeNull",!0):a.$setValidity("vcodeNull",!1),e.vcodeRule?a.$setValidity("vcodeRule",!0):a.$setValidity("vcodeRule",!1),e.vcodeNull&&e.vcodeRule?(a.$setValidity("vcode",!0),t):(a.$setValidity("vcode",!1),t)}),a.$formatters.unshift(function(t){return e.vcodeNull=""==t?void 0:"valid",e.vcodeRule=/^\s*[0-9]{5}\s*$/.test(t)?"valid":void 0,e.vcodeNull?a.$setValidity("vcodeNull",!0):a.$setValidity("vcodeNull",!1),e.vcodeRule?a.$setValidity("vcodeRule",!0):a.$setValidity("vcodeRule",!1),e.vcodeNull&&e.vcodeRule?(a.$setValidity("vcode",!0),t):(a.$setValidity("vcode",!1),t)})}}}).directive("cdkey",function(){return{scope:{},require:"ngModel",link:function(e,t,i,a){angular.element(t).focusin(function(){a.$dirty=!0,a.$pristine=!1}),a.$parsers.unshift(function(t){return e.cdkeyNull=""==t?void 0:"valid",e.cdkeyRule=/^[a-hj-np-zA-HJ-NP-Z1-9]{8}$/.test(t)?"valid":void 0,e.cdkeyNull?a.$setValidity("cdkeyNull",!0):a.$setValidity("cdkeyNull",!1),e.cdkeyRule?a.$setValidity("cdkeyRule",!0):a.$setValidity("cdkeyRule",!1),e.cdkeyNull&&e.cdkeyRule?(a.$setValidity("cdkey",!0),t):(a.$setValidity("cdkey",!1),t)}),a.$formatters.unshift(function(t){return e.cdkeyNull=""==t?void 0:"valid",e.cdkeyRule=/^[a-hj-np-zA-HJ-NP-Z1-9]{8}$/.test(t)?"valid":void 0,e.cdkeyNull?a.$setValidity("cdkeyNull",!0):a.$setValidity("cdkeyNull",!1),e.cdkeyRule?a.$setValidity("cdkeyRule",!0):a.$setValidity("cdkeyRule",!1),e.cdkeyNull&&e.cdkeyRule?(a.$setValidity("cdkey",!0),t):(a.$setValidity("cdkey",!1),t)})}}}).directive("captcha",function(){return{scope:{},require:"ngModel",link:function(e,t,i,a){angular.element(t).focusin(function(){a.$dirty=!0,a.$pristine=!1}),a.$parsers.unshift(function(t){return e.captchaNull=""==t?void 0:"valid",e.captchaNull?a.$setValidity("captchaNull",!0):a.$setValidity("captchaNull",!1),e.captchaNull?(a.$setValidity("captcha",!0),t):(a.$setValidity("captcha",!1),t)}),a.$formatters.unshift(function(t){return e.captchaNull=""==t?void 0:"valid",e.captchaNull?a.$setValidity("captchaNull",!0):a.$setValidity("captchaNull",!1),e.captchaNull?(a.$setValidity("captcha",!0),t):(a.$setValidity("captcha",!1),t)})}}}).directive("alert",["$timeout",function(e){return{restrict:"A",scope:{content:"@",type:"@alerttype"},template:'<div class="alert-tips tips {{type}}" ng-bind="content"></div>',replace:!0,link:function(t,i){function a(){angular.element(i).remove()}e(a,3e3)}}}]).directive("idTypeSelect",function(){return{restrict:"A",scope:{selected:"=",array:"=",ishover:"=?"},template:'<span ng-bind="name" style="width:100%;"></span><div class="select-wrap" style="display: none"><div ng-repeat="(key,value) in array" ng-class="{hover:hover==key}" ng-mouseenter="hoverFun(key)" ng-click="change(key)" class="select-option" ng-bind="value"></div></div>',link:function(e,t){angular.element(t).hover(function(){angular.isUndefined(e.ishover)?angular.element(t).find(".select-wrap").show():e.ishover||angular.element(t).find(".select-wrap").show()},function(){angular.element(t).find(".select-wrap").hide()}),e.hover=!1,e.show=!1,e.name=e.array[e.selected],e.hoverFun=function(t){e.hover=t},e.change=function(i){e.selected=i,e.name=e.array[i],e.show=!1,angular.element(t).find(".select-wrap").hide()},e.$watch("selected",function(){e.name=e.array[e.selected]})}}}).directive("seats",function(){return{restrict:"A",scope:{selected:"=",seatForm:"=",sold:"=",ticket:"=",col:"=",row:"="},template:'<div class="row" ng-repeat="srow in newArray track by $index"><div class="seat" ng-repeat="scol in srow track by $index" ng-bind="scol.type!=0?scol.rowNo+scol.colNo:\'\'" ng-class="{none:scol.type==0,selected:(sold | seatSelected:(scol.rowNo+scol.colNo)),lock:(selected | seatSelected : (scol.rowNo+scol.colNo))}" ng-click="selectSeat($parent.$index,$index,$event)"></div></div>',link:function(e){e.newArray=[];for(var t=0;t<e.row;t++)e.newArray.push(e.seatForm.splice(0,e.col));e.selectSeat=function(t,i,a){if(!angular.element(a.target).hasClass("selected")&&!angular.element(a.target).hasClass("none")){var l=e.selected.indexOf(e.newArray[t][i].rowNo+e.newArray[t][i].colNo);l>-1?e.selected.splice(l,1):e.selected.length<e.ticket&&e.selected.push(e.newArray[t][i].rowNo+e.newArray[t][i].colNo)}}}}}).filter("stock",function(){return function(e,t,i){var a=!1,l=[],n=t.split("-");return angular.forEach(e,function(e){var t=e.day.split("-");parseInt(t[0],10)==parseInt(n[0],10)&&parseInt(t[1],10)==parseInt(n[1],10)&&parseInt(t[2],10)==parseInt(i,10)&&e.count>=0&&(a=!0,l=e)}),{flag:a,stock:l}}}).filter("seatButton",function(){return function(e,t){var i=!0;return angular.forEach(e,function(e){e.length!=t&&(i=!1)}),i}}).filter("selectedDay",function(){return function(e,t,i){if(e){var a=t.split("-"),l=e.split("-");return parseInt(l[0])===parseInt(a[0])&&parseInt(l[1])===parseInt(a[1])&&parseInt(l[2])===parseInt(i)?!0:!1}return!1}}).filter("to_trusted",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("dayAdd",function(){return function(e,t){var i=e.split("-"),a=new Date(i[0],i[1]-1,parseInt(i[2])+t);return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()}}).filter("dayCN",function(){return function(e){var t=e.split("-");return t[0]+"年"+t[1]+"月"+t[2]+"日"}}).filter("statusFilter",function(){return function(e,t){var i=[];return"all"==t?e:""==t?(angular.forEach(e,function(e){"stpass"==e.gatewayCode&&i.push(e)}),i):(angular.forEach(e,function(e){e.statue==t&&i.push(e)}),i)}}).filter("timeFilter",function(){return function(e,t){return new Date((new Date).setDate(new Date(e).getDate()+t))}}).filter("timeFilterTwo",function(){return function(e,t){return 0!=t&&(t-=1),new Date((new Date).setDate(new Date(e).getDate()+t))}}).filter("seatSelected",function(){return function(e,t){return e.indexOf(t)>-1?!0:!1}}).filter("nodes",function(){return function(e){var t=[];return angular.forEach(e,function(e,i){t.push({title:e.title,nodes:[]}),angular.forEach(e.sections,function(e){0==e.nodes.length&&t[i].nodes.push({brief:"",image:e.pictures[0],name:e.sectionTitle,startTime:"",costs:e.costs,pictures:e.pictures,sectionDesc:e.sectionDesc,sectionTitle:e.sectionTitle,sectionDistanceDesc:e.sectionDistanceDesc?e.sectionDistanceDesc:""}),angular.forEach(e.nodes,function(a,l){t[i].nodes.push(0==l?{brief:a.brief,image:a.image,name:a.name,startTime:a.startTime,costs:e.costs,pictures:e.pictures,sectionDesc:e.sectionDesc,sectionTitle:e.sectionTitle,sectionDistanceDesc:e.sectionDistanceDesc?e.sectionDistanceDesc:""}:{brief:a.brief,image:a.image,name:a.name,startTime:a.startTime,costs:e.costs,pictures:e.pictures,sectionDesc:e.sectionDesc,sectionTitle:e.sectionTitle})})})}),t}}).filter("tourismFilter",function(){return function(e,t,i){var a={};if("all"==t)for(key in e)a[key]=e[key];else a[t]=e[t];var l={},n=[];for(key in a)n=[],angular.forEach(a[key],function(e){e.tourismDays==i&&"4"!=i||"all"==i?n.push(e):i>="4"&&e.tourismDays>="4"&&n.push(e)}),n.length>0&&(l[key]=n);return l}}).filter("noContentFilter",function(){return function(e,t,i){var a=[];if("all"==t)for(var l in e)angular.forEach(e[l],function(e){e.tourismDays==i&&a.push(e)});else if("all"==i)for(var n in e)n==t&&angular.forEach(e[n],function(e){a.push(e)});else for(var r in e)angular.forEach(e[r],function(e){a.push(e)});if(0==a.length){for(var s in e)0!=e[s].length&&angular.forEach(e[s],function(e){a.push(e)});return a}return a}}).filter('calculateCoupon',function() {
    return function(selectQuota,selectType,couponUnit,price) {
        var payInfo = {
            couponQuota: '',
            payPrice: ''
        };
        if(selectType == 'A') {
            if(price - selectQuota <= 0) {
                payInfo.couponQuota = '- '+ Number(price - 0.01).toFixed(2);
            } else {
                payInfo.couponQuota = '- '+ Number(selectQuota).toFixed(2);
            }
            payInfo.payPrice = price - selectQuota >= 0 ? (price - selectQuota).toFixed(2) : '0.01';
        } else if(selectType == 'B') {
            payInfo.couponQuota = '- '+ (price * (1-selectQuota/10)).toFixed(2) ;
            payInfo.payPrice = (price * selectQuota / 10).toFixed(2);
        } else if(selectType == 'C'){
            payInfo.couponQuota = '- '+ (price - 0.01).toFixed(2);
            payInfo.payPrice = '0.01';
        } else {
            payInfo.couponQuota = '- 0.00';
            payInfo.payPrice = Number(price).toFixed(2);
        }
        return payInfo;
    };
});